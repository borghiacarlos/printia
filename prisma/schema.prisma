// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Example model - customize as needed
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 1. Produtos e Venda (O que o cliente vê)
model Product {
  id          String       @id @default(cuid())
  name        String       // Ex: "Folheto A4"
  category    String       // Ex: "Promocional"
  description String?
  prices      PriceTable[] // Relacionamento com a tabela de preços
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("products")
}

// A sua lógica de "Tabela de Preços Escalonada"
model PriceTable {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  
  minQuantity Int      // Ex: 1
  maxQuantity Int      // Ex: 10
  unitPrice   Decimal  @db.Decimal(10, 2) // Ex: 7.00 (Decimal é vital para dinheiro)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("price_tables")
}

// 2. Acabamentos (Com lógica de preço fixo + variável)
model Finishing {
  id            String   @id @default(cuid())
  name          String   // Ex: "Laminação Fosca"
  
  // Aqui mudamos para diferenciar Custo (seu gasto) de Preço (venda)
  priceFixed    Decimal  @default(0) @db.Decimal(10, 2) // Setup da máquina (se houver)
  pricePerUnit  Decimal  @default(0) @db.Decimal(10, 2) // Valor por folha/unidade
  
  isActive      Boolean  @default(true) // Para "desligar" um acabamento sem apagar
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("finishings")
}

// 3. Materiais e Papéis (Substitui sua planilha de "Papeis")
model PaperStock {
  id            String   @id @default(cuid())
  name          String   // Ex: "Couchê 170g"
  brand         String?  // Fornecedor/Marca
  
  grammage      Int      // 170 (g/m²) - Importante para filtros
  format        String   // "A3", "SRA3", "66x96"
  
  packetCost    Decimal  @db.Decimal(10, 2) // Custo do pacote (R$ 50,00)
  packetQty     Int      // Quantas folhas vêm (250)
  
  // Campo calculado virtualmente no front, mas bom ter referência se quiser
  unitCost      Decimal? @db.Decimal(10, 4) // Custo unitário com mais casas decimais (R$ 0,2000)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("paper_stocks")
}

// 4. Inteligência de Máquinas (Sua planilha de Consumíveis/Contadores)
model Printer {
  id          String   @id @default(cuid())
  name        String   // Ex: "Konica Minolta 2060"
  currentCounter Int   @default(0) // Contador atual geral (para referência rápida)
  
  supplies    PrinterSupply[] // Histórico de trocas de toner/peças
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("printers")
}

model PrinterSupply {
  id          String   @id @default(cuid())
  printerId   String
  printer     Printer  @relation(fields: [printerId], references: [id])
  
  itemName    String   // Ex: "Toner Ciano TN-619"
  cost        Decimal  @db.Decimal(10, 2) // Quanto pagou
  
  startCounter Int     // Contador quando colocou a peça (Ex: 150.000)
  endCounter   Int?    // Contador quando acabou (Preenchido só na próxima troca)
  
  installedAt DateTime @default(now()) // Data da troca
  
  @@map("printer_supplies")
}
